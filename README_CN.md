# OpenVPNAdvanced (ä¸­æ–‡æ–‡æ¡£)

> ä¸€ä¸ªåŸºäºè§„åˆ™çš„ OpenVPN æµé‡åˆ†æµå™¨ï¼Œæ”¯æŒ DoH DNS ä»£ç†ã€è§„åˆ™è®¢é˜…ã€åŠ¨æ€è·¯ç”±æ³¨å…¥ã€DNS ç¼“å­˜ç­‰åŠŸèƒ½ã€‚

---
[English Documentation](https://github.com/iaaaannn0/openvpnadvanced/blob/main/README.md)

## ğŸ“š ç›®å½•

- [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
- [åŠŸèƒ½ç‰¹æ€§](#åŠŸèƒ½ç‰¹æ€§)
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
  - [ç¯å¢ƒè¦æ±‚](#ç¯å¢ƒè¦æ±‚)
  - [æ„å»ºå®‰è£…](#æ„å»ºå®‰è£…)
  - [å¯åŠ¨æœåŠ¡](#å¯åŠ¨æœåŠ¡)
  - [é…ç½®æœ¬åœ° DNS](#é…ç½®æœ¬åœ°-dns)
- [é…ç½®æŒ‡å—](#é…ç½®æŒ‡å—)
- [å·¥ä½œåŸç†](#å·¥ä½œåŸç†)
- [ç³»ç»Ÿæ¶æ„](#ç³»ç»Ÿæ¶æ„)
- [æ¨¡å—è¯´æ˜](#æ¨¡å—è¯´æ˜)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)
- [æ€§èƒ½ä¼˜åŒ–](#æ€§èƒ½ä¼˜åŒ–)
- [å®‰å…¨ä¸éšç§](#å®‰å…¨ä¸éšç§)
- [å¦‚ä½•éªŒè¯ VPN è·¯ç”±](#å¦‚ä½•éªŒè¯-vpn-è·¯ç”±)
- [å¼€å‘è€…æŒ‡å—](#å¼€å‘è€…æŒ‡å—)
- [è®¸å¯è¯](#è®¸å¯è¯)

---

## é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®æ—¨åœ¨ä¸º OpenVPN ç”¨æˆ·æä¾›ä¸€ä¸ªé«˜æ€§èƒ½ã€çµæ´»çš„åŸºäºè§„åˆ™çš„æµé‡åˆ†æµå™¨ã€‚å®ƒå¯ä»¥é˜²æ­¢æ‰€æœ‰æµé‡éƒ½é€šè¿‡ VPNï¼Œå¹¶æ”¯æŒè§„åˆ™è®¢é˜…ã€DNS ç¼“å­˜ã€CNAME è§£æå’Œ DNS æ±¡æŸ“é˜²æŠ¤ã€‚

### ä¸»è¦ä¼˜åŠ¿
- **æ™ºèƒ½æµé‡è·¯ç”±**ï¼šåŸºäºè§„åˆ™è‡ªåŠ¨è·¯ç”±æµé‡
- **å¢å¼ºéšç§ä¿æŠ¤**ï¼šæ”¯æŒ DoH (DNS over HTTPS) å®‰å…¨ DNS æŸ¥è¯¢
- **æå‡æ€§èƒ½**ï¼šDNS ç¼“å­˜å’Œä¼˜åŒ–çš„è·¯ç”±
- **æ˜“äºç®¡ç†**ï¼šç®€å•çš„é…ç½®å’Œè§„åˆ™ç®¡ç†
- **å®æ—¶ç›‘æ§**ï¼šå…¨é¢çš„æ—¥å¿—å’ŒçŠ¶æ€è·Ÿè¸ª

---

## åŠŸèƒ½ç‰¹æ€§

### æ ¸å¿ƒåŠŸèƒ½
- âœ… æœ¬åœ° DNS ä»£ç†ï¼ˆæ”¯æŒ DoH / TCP / UDPï¼‰
- âœ… è‡ªå®šä¹‰è§„åˆ™å’Œè¿œç¨‹è®¢é˜…ï¼ˆè‡ªåŠ¨å»é‡å’Œåˆå¹¶ï¼‰
- âœ… ç²¾ç¡®è·¯ç”±ï¼ˆé€šè¿‡ utunX æ·»åŠ é™æ€è·¯ç”±ï¼‰
- âœ… è‡ªåŠ¨ VPN æ¥å£æ£€æµ‹ï¼ˆå¦‚ utun0 / utun8ï¼‰
- âœ… ä¿®å¤é»˜è®¤ macOS ç½‘å…³åˆ°ç›´è¿ç½‘ç»œæ¥å£
- âœ… æ”¯æŒé€’å½’ CNAME è§£æ
- âœ… é€šè¿‡ç¼“å­˜å®ç°è¶…å¿«é€Ÿå“åº”
- âœ… ä¸€é”®å¯åŠ¨ï¼Œæ— éœ€å¤æ‚è®¾ç½®

### é«˜çº§åŠŸèƒ½
- ğŸ” åŸŸåè¿½è¸ªå·¥å…· (`trace.go`)
  - è¯¦ç»†çš„ç½‘ç»œä¿¡æ¯æ˜¾ç¤º
  - è·¯ç”±è·¯å¾„åˆ†æ
  - è‡ªåŠ¨è·¯ç”±ä¿®å¤
  - CNAME é“¾å¯è§†åŒ–
- ğŸ“Š äº¤äº’å¼æ§åˆ¶å° (`ovpnctl`)
  - å®æ—¶æ—¥å¿—æŸ¥çœ‹
  - è·¯ç”±æµ‹è¯•
  - æ¥å£ç®¡ç†
  - é…ç½®é‡è½½

---

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Go 1.18+
- macOSï¼ˆæ”¯æŒ `route`ã€`scutil` ç­‰å‘½ä»¤ï¼‰
- å·²è¿æ¥çš„ OpenVPN å®¢æˆ·ç«¯ï¼ˆå¦‚ Tunnelblickï¼‰

### æ„å»ºå®‰è£…

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/iaaaannn0/openvpnadvanced.git
cd openvpnadvanced

# æ„å»ºé¡¹ç›®
go build -o openvpnadvanced ./cmd
```

### å¯åŠ¨æœåŠ¡

```bash
# å¯åŠ¨æœåŠ¡
sudo ./openvpnadvanced
```

### äº¤äº’å¼æ§åˆ¶å°

è¯¥å·¥å…·æä¾›äº†ä¸€ä¸ªäº¤äº’å¼å‘½ä»¤æ§åˆ¶å° (ovpnctl) ç”¨äºè¿è¡Œæ—¶æ§åˆ¶ã€‚

#### å¯åŠ¨æ§åˆ¶å°

```bash
sudo ./openvpnadvanced --start
```

#### å¯ç”¨å‘½ä»¤

| å‘½ä»¤ | æè¿° | ç¤ºä¾‹ |
|------|------|------|
| `start` | åœ¨åå°å¯åŠ¨æ ¸å¿ƒé€»è¾‘ | `start` |
| `startv` | å¯åŠ¨å¹¶æ˜¾ç¤ºå®æ—¶æ—¥å¿— | `startv` |
| `status` | æ£€æŸ¥æœåŠ¡çŠ¶æ€ | `status` |
| `view-log` | ä½¿ç”¨è¿‡æ»¤å™¨æŸ¥çœ‹æ—¥å¿— | `view-log info` |
| `test` | æµ‹è¯•åŸŸåè§„åˆ™åŒ¹é… | `test example.com` |
| `rtest` | æµ‹è¯•åŸŸåè§£æ | `rtest example.com` |
| `show-iface` | æ˜¾ç¤ºæ¥å£ä¿¡æ¯ | `show-iface` |
| `reload-config` | é‡è½½é…ç½® | `reload-config` |
| `clear` | æ¸…ç©ºæ§åˆ¶å° | `clear` |

### åŸŸåè¿½è¸ªå·¥å…·

`trace.go` å·¥å…·æä¾›æœ‰å…³åŸŸåè§£æå’Œè·¯ç”±çš„è¯¦ç»†ä¿¡æ¯ï¼š

```bash
# è¿è¡Œè¿½è¸ªå·¥å…·
go run tools/trace.go example.com
```

#### è¾“å‡ºä¿¡æ¯
- ç½‘ç»œä¿¡æ¯
  - åŸŸåè§£æ
  - IP åœ°å€
  - åŒ¹é…è§„åˆ™
  - CNAME é“¾
- è·¯ç”±ä¿¡æ¯
  - å½“å‰æ¥å£
  - VPN æ¥å£
  - é»˜è®¤ç½‘å…³
  - è·¯ç”±çŠ¶æ€

---

## é…ç½®æŒ‡å—

### DNS é…ç½®
1. å°†æœ¬åœ° DNS è®¾ç½®ä¸º 127.0.0.1
2. åœ¨ `config.ini` ä¸­é…ç½® DNS ä»£ç†è®¾ç½®
3. æ·»åŠ è‡ªå®šä¹‰è§„åˆ™æˆ–è®¢é˜…è§„åˆ™åˆ—è¡¨

### è§„åˆ™ç®¡ç†
- æœ¬åœ°è§„åˆ™ï¼š`assets/rule.list`
- è¿œç¨‹è®¢é˜…ï¼šåœ¨ `config.ini` ä¸­æ·»åŠ  URL
- è‡ªåŠ¨æ›´æ–°ï¼šåœ¨ `config.ini` ä¸­é…ç½®

---

## å·¥ä½œåŸç†

1. **DNS è§£æ**
   - æœ¬åœ° DNS ä»£ç†å¤„ç†æŸ¥è¯¢
   - æ”¯æŒ DoH å®‰å…¨æŸ¥è¯¢
   - ç¼“å­˜å“åº”ä»¥æé«˜æ€§èƒ½

2. **æµé‡è·¯ç”±**
   - åˆ†æåŸŸåè§„åˆ™
   - é€šè¿‡ VPN æˆ–ç›´è¿è·¯ç”±æµé‡
   - ç»´æŠ¤æœ€ä¼˜è·¯ç”±è·¯å¾„

3. **æ¥å£ç®¡ç†**
   - æ£€æµ‹ VPN æ¥å£
   - ç®¡ç†ç½‘ç»œè·¯ç”±
   - å¤„ç†æ¥å£å˜æ›´

---

## ç³»ç»Ÿæ¶æ„

```
â”œâ”€â”€ cmd/                 # å‘½ä»¤è¡Œæ¥å£
â”œâ”€â”€ dnsmasq/            # DNS ä»£ç†å®ç°
â”œâ”€â”€ vpn/                # VPN è·¯ç”±ç®¡ç†
â”œâ”€â”€ tools/              # å·¥å…·é›†
â”‚   â””â”€â”€ trace.go        # åŸŸåè¿½è¸ªå·¥å…·
â”œâ”€â”€ assets/             # é…ç½®å’Œè§„åˆ™
â””â”€â”€ config.ini          # ä¸»é…ç½®æ–‡ä»¶
```

---

## æ¨¡å—è¯´æ˜

### DNS ä»£ç† (`dnsmasq/`)
- å¤„ç† DNS æŸ¥è¯¢
- å®ç°ç¼“å­˜
- æ”¯æŒ DoH
- ç®¡ç†è§„åˆ™

### VPN è·¯ç”± (`vpn/`)
- ç®¡ç†ç½‘ç»œæ¥å£
- å¤„ç†è·¯ç”±æ³¨å…¥
- æ£€æµ‹ VPN çŠ¶æ€
- ä¿®å¤è·¯ç”±é—®é¢˜

### å·¥å…·é›† (`tools/`)
- åŸŸåè¿½è¸ª
- è·¯ç”±æµ‹è¯•
- æ¥å£æ£€æŸ¥
- æ—¥å¿—ç®¡ç†

---

## å¸¸è§é—®é¢˜

### å¸¸è§é—®é¢˜
1. **DNS ä¸å·¥ä½œ**
   - æ£€æŸ¥æœ¬åœ° DNS è®¾ç½®
   - éªŒè¯ DNS ä»£ç†æ˜¯å¦è¿è¡Œ
   - æ£€æŸ¥è§„åˆ™é…ç½®

2. **VPN è·¯ç”±é—®é¢˜**
   - éªŒè¯ VPN è¿æ¥
   - æ£€æŸ¥æ¥å£æ£€æµ‹
   - å®¡æŸ¥è·¯ç”±è§„åˆ™

3. **æ€§èƒ½é—®é¢˜**
   - æ¸…é™¤ DNS ç¼“å­˜
   - ä¼˜åŒ–è§„åˆ™
   - æ£€æŸ¥ç½‘ç»œçŠ¶å†µ

---

## æ€§èƒ½ä¼˜åŒ–

### DNS ä¼˜åŒ–
- å®ç°ç¼“å­˜
- ä¼˜åŒ–è§„åˆ™åŒ¹é…
- ä½¿ç”¨é«˜æ•ˆç®—æ³•

### è·¯ç”±ä¼˜åŒ–
- æœ€å°åŒ–è·¯ç”±å˜æ›´
- ä¼˜åŒ–æ¥å£æ£€æµ‹
- ç¼“å­˜è·¯ç”±å†³ç­–

---

## å®‰å…¨ä¸éšç§

### DNS å®‰å…¨
- æ”¯æŒ DoH
- DNS ç¼“å­˜ä¿æŠ¤
- è§„åˆ™éªŒè¯

### è·¯ç”±å®‰å…¨
- å®‰å…¨è·¯ç”±æ³¨å…¥
- æ¥å£éªŒè¯
- è®¿é—®æ§åˆ¶

---

## å¦‚ä½•éªŒè¯ VPN è·¯ç”±

1. ä½¿ç”¨è¿½è¸ªå·¥å…·ï¼š
```bash
go run tools/trace.go example.com
```

2. æ£€æŸ¥è·¯ç”±ä¿¡æ¯ï¼š
```bash
sudo ./openvpnadvanced --start
ovpnctl> rtest example.com
```

---

## å¼€å‘è€…æŒ‡å—

### æ„å»º
```bash
go build -o openvpnadvanced ./cmd
```

### æµ‹è¯•
```bash
go test ./...
```

### è´¡çŒ®
1. Fork ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯
3. æäº¤ Pull Request

---

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶ã€‚

```
MIT License

Copyright (c) 2025

Permission is hereby granted, free of charge, to any person obtaining a copy...
```

---

æ¬¢è¿ Starâ­ã€æ Issueã€æ PRï¼Œä¸€èµ·å®Œå–„è¿™ä¸ªå¼ºå¤§å®ç”¨çš„ VPN åˆ†æµå·¥å…·ï¼
